<?php
// +------------------------------------------------------------------
// | 前端标签数据处理器
// +------------------------------------------------------------------
// | Author：liwensong
// +------------------------------------------------------------------
// | Email: septet-l@outlook.com
// +------------------------------------------------------------------

class Vapi_logic extends MY_Model_Member {

    //新建批量发送优惠任务
    public function coupon_task_tag(){
        $tag_data = array(
            'status'=>1000,
            'err'=>0,
            'msg'=>'OK',
            'msg_type'=>'toast',
        );

        $inter_id = $this->session->get_admin_inter_id();
        $member_lvl = $this->common_model->get_admin_member_lvl($inter_id,'member_lvl_id,lvl_name,is_default');

        //获取礼包信息
        $this->load->model('membervip/admin/Package_model','package_model');
        $field = "p.package_id,p.inter_id,p.name,pl.ele_type,pl.ele_value,pl.ele_num,pl.package_element_id,pl.status,p.status as package_status";
        $package_info = $this->package_model->get_packages_elements_list($inter_id,'',$field);

        //获取优惠券信息
        $this->load->model('membervip/admin/Card_model','card_model');
        $field = "card_id,inter_id,title,time_start,time_end,use_time_end_model,use_time_end,card_stock";
        $card_info = $this->card_model->get_can_received($inter_id,'',$field);

        $tag_data_group = array(
            'page_resource'=>array(
                'links'=>array(
                    'list'=>EA_const_url::inst()->get_url('*/membertask/coupon_task'),
                    'post'=>EA_const_url::inst()->get_url('*/membertask/save_create'),
                    'edit'=>EA_const_url::inst()->get_url('*/membertask/create'),
                    'first_check'=>EA_const_url::inst()->get_url('*/membertask/first_create_check'),
                )
            )
        );

        $tag_data_group['input_tag'] = array(
            //任务名称
            'task_name'=>array(
                'name'=>'请填写任务名称',
                'value'=>''
            ),
            //发送内容
            'receive_repeat'=>array(
                'name'=>'重复领取',
                'value'=>1
            ),
            'temp_title'=>array(
                'name'=>'模版消息',
                'value'=>'会员权益到账通知',
            ),
            'temp_id'=>array(
                'name'=>'模版ID',
                'value'=>'',
            ),
            'auto_jump_url'=>array(
                'name'=>'自定义链接',
                'value'=>'',
            )
        );


        $tag_data_group['temp_input_group'] = array(
            array(
                'name'=>'first',
                'field'=>'first',
                'value'=>'您好，您的会员奖励已经成功到账'
            ),
            array(
                'name'=>'keyword1',
                'field'=>'keyword1',
                'value'=>'{membernum}{username}',
            ),
            array(
                'name'=>'keyword2',
                'field'=>'keyword2',
                'value'=>'{temp_content}',
            ),
            array(
                'name'=>'keyword3',
                'field'=>'keyword3',
                'value'=>'会员奖励',
            ),
            array(
                'name'=>'keyword4',
                'field'=>'keyword4',
                'value'=>'{send_time}',
            ),
            array(
                'name'=>'remark',
                'field'=>'remark',
                'value'=>'马上查看',
            ),
        );

        $tag_data_group['enum_des'] = array(
            'send_type'=>array(
                1 => '发送优惠券',
                2 => '发送礼包'
            ),
            'card'=>$card_info,
            'package'=>$package_info,
            'send_target'=>array(
                1 => '会员等级',
                2 => 'RFM模型',
                3 => '导入发放名单'
            ),
            'send_member_lvl[]'=>$member_lvl,
            'source'=>array(
                1 => '订房',
                2 => '商城'
            ),
            'rfm'=>array(
                'r' => 'R 最近一次消费',
                'f' => 'F 消费频次',
                'm' => 'M 消费金额'
            ),
            'r_level'=>array(
                1 => '高活跃用户',
                2 => '中活跃',
                3 => '一般活跃',
                4 => '沉睡用户'
            ),
            'f_level'=>array(
                1 => '新用户',
                2 => '老用户',
                3 => '成熟用户',
                4 => '忠诚用户'
            ),
            'm_level'=>array(
                1 => '低贡献',
                2 => '中贡献',
                3 => '中高贡献',
                4 => '高贡献'
            ),
            'send_target_field'=>array(
                1 => '手机号码',
                2 => '会员ID',
                3 => '会员卡号',
                4 => 'OPEN ID'
            ),
            'target_type'=>array(
                1 => '录入用户手机号码',
                2 => '导入文件'
            ),
            'is_send_temp'=>array(
                1 => '录入用户手机号码',
                2 => '导入文件'
            ),
            'jump_type'=>array(
                1 => '跳转链接',
                2 => '自定义链接',
                3 => '无跳转'
            ),
            'jump_url'=>array(
                1 => '优惠券列表',
                2 => '会员中心'
            )
        );

        $tag_data_group['page_field'] = array(
            'send_member_lvl[]',
            'send_value',
            'send_target_value',
            'send_target_file'
        );

        $tag_data_group['page_hint'] = array(
            'temp_hint'=>array(
                '',
                '酒店旅游 - 酒店',
                'XXX',
                '会员权益到账通知'
            ),
            'temp_contet_hint'=>array(
                '{{first.DATA}}',
                '会员卡号：{{keyword1.DATA}}',
                '成功到账：{{keyword2.DATA}}',
                '来源：{{keyword3.DATA}}',
                '{{keyword3.DATA}}',
                '{{keyword3.DATA}}'
            ),
            'temp_field_hint'=>array(
                '会员卡号：{membernum}',
                '优惠券发送内容：{temp_content}',
                '发送时间：{send_time}',
                '会员名称：{username}',
            )
        );

        $tag_data['web_data'] = $tag_data_group;

        return $tag_data;
    }
}