<!-- DataTables -->
<link rel="stylesheet" href="<?php echo base_url(FD_PUBLIC). '/'. $tpl ?>/plugins/datatables/dataTables.bootstrap.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="<?php echo base_url(FD_PUBLIC) ?>/js/html5shiv.min.js"></script>
<script src="<?php echo base_url(FD_PUBLIC) ?>/js/respond.min.js"></script>
<![endif]-->
<link href="<?php echo base_url(FD_PUBLIC) ?>/js/art_Dialog/skins/default.css" rel="stylesheet" />
<link rel='stylesheet' href='<?php echo base_url(FD_PUBLIC) ?>/AdminLTE/plugins/date-timepicker/jquery.datetimepicker.css'>
<script type="text/javascript" src="<?php echo base_url(FD_PUBLIC) ?>/AdminLTE/plugins/date-timepicker/jquery.datetimepicker.min.js"></script>
<link rel="stylesheet" href="<?php echo base_url(FD_PUBLIC) ?>/AdminLTE/plugins/new/huang.css">
<script type="text/javascript">
    //全局变量
    var GV = {
        DIMAUB: "<?php echo base_url();?>",
        JS_ROOT: "<?php echo FD_PUBLIC;?>/js/",
        JS__ROOT:"<?php echo base_url(FD_PUBLIC);?>/js/"
    };
</script>
<script src="<?php echo base_url(FD_PUBLIC);?>/js/wind.js"></script>
<style type="text/css">
    html, body{min-width: 100%;}
    .weborder {
        background: #FFFFFF !important;
        display: none;
    }

    .morder {
        background: #FAFAFA !important;
    }

    .a_like {
        cursor: pointer;
        color: #72afd2;
    }

    .page {
        text-align: right;
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-size: 2em;
    }

    .page a {
        padding: 10px;
    }

    .current {
        color: #000000;
    }
    .iconfont{
        font-family:"iconfont" !important;
        font-size:16px;font-style:normal;
        -webkit-font-smoothing: antialiased;
        -webkit-text-stroke-width: 0.2px;
        -moz-osx-font-smoothing: grayscale;
    }
    .over_x{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;-webkit-overflow-scrolling:touch;overflow-scrolling:touch;}
    .clearfix:after{content:"" ;display:block;height:0;clear:both;visibility:hidden;}
    .bg_fff{background:#fff;}
    .color_fff{color:#fff;}
    .bg_ff0000{background:#ff0000;}
    .bg_f8f9fb{background:#f8f9fb;}
    .bg_ff9900{background:#ff9900;}
    .bg_f8f9fb{background:#f8f9fb;}
    .bg_fe6464{background:#fe6464;}
    .bg_eee{background:#EEEEEE}
    .color_72afd2{color:#72afd2;}
    .color_ff9900{color:#ff9900;}
    .color_F99E12{color:#F99E12;}
    .color_main{color:#ff9900;}

    a{color:#92a0ae;}
    .relative{position:relative;}
    .absolute{position:absolute;}
    .center{text-align:center;}
    .flex{display:flex;align-items:center;}
    .h24{font-size:24px;font-family:arial;}

    .border_1{border:1px solid #d7e0f1;}
    .f_r{float:right;}
    .f_l{float:left;}
    .p_0_20{padding:0 20px;}
    .w_90{width:90px;}
    .w_200{width:200px;}
    .p_r_30{padding-right:30px;}
    .m_t_10{margin-top:10px;}
    .p_0_30_0_10{padding:0 30px 0 10px;}
    .b_b_1{border-bottom:1px solid #d7e0f1;}
    .b_t_1{border-top:1px solid #d7e0f1;}
    .p_t_10{padding-top:10px;}
    .p_b_10{padding-bottom:10px;}

    .banner{height:50px;width:100%;line-height:50px;border-bottom:1px solid #d7e0f1;padding-right:0px;}
    .banner > span{padding:0px 5px;margin-left:5px;border-radius:3px;font-size:11px;}
    .news{position:relative;cursor:pointer;background:#fe8f00;height:100%;padding:0px 12px;color:#fff;}
    .news_radius{padding:0 2px;border-radius:3px;background:#fff;color:#fe8f00;text-align:center;font-size:8px;margin-left:8px;}
    .display_flex{display:flex;display:-webkit-flex;display:box;display:-webkit-box;justify-content:top;align-items:center;-webkit-align-items:center;}
    .display_flex >th,.display_flex >td,.display_flex >div{-webkit-flex:1;flex:1;-webkit-box-flex:1;box-flex:1;cursor:pointer;}
    .j_toshow{width:320px;min-height:100%;position:absolute;top:50px;right:-330px;box-shadow:-5px 0px 15px rgba(0,0,0,0.1);-webkit-box-shadow:-5px 0px 15px rgba(0,0,0,0.1);z-index:9999;}
    .toshow_con{padding:12px;}
    .t_con_list{margin-bottom:12px;height:170px;}
    .close_btn{cursor:pointer;}
    .toshow_con_titl{background:#f0f3f6;font-size:13px;padding:10px;border-bottom:1px solid #d7e0f1;}
    .toshow_con_list{padding:10px;font-size:11px;height:114px;overflow:hidden;}
    .toshow_con_list >a{display:block;margin-bottom:5px;}
    .toshow_con_list >a:last-child{margin-bottom:0px;}
    .toshow_titl_txt{position:relative;}
    .radius_txt{position:absolute;top:0px;left:105%;border-radius:3px;text-align:center;padding:0px 3px;font-size:12px;}
    select,input,.moba{height:30px;line-height:30px;border:1px solid #d7e0f1;text-indent:3px;}

    .contents{padding:20px 20px 20px;}
    .contents_list{display:table;width:100%;border-bottom:1px solid #d7e0f1;margin-bottom:10px;}
    .head_cont{padding:20px 0 20px 10px;}
    .head_cont >div{margin-bottom:10px;cursor:pointer;}
    .head_cont >div:last-child{margin-bottom:0px;}
    .j_head >div{display:inline-block;}
    .j_head >div:nth-of-type(1){width:307px;}
    .j_head >div:nth-of-type(2){width:432px;}
    .j_head >div:nth-of-type(3){width:255px;}
    .j_head >div >span:nth-of-type(1){display:inline-block;width:60px;text-align:center;}
    .h_btn_list .actives{background:#ff9900;color:#fff;border:1px solid #ff9900 !important;}
    .h_btn_list> div{display:inline-block;width:100px;border:1px solid #d7e0f1;text-align:center;padding:6px 0px;border-radius:5px;margin-right:8px;}
    .h_btn_list> div:last-child{margin-right:0px;}
    .classification{height:30px;line-height:30px;border-top:1px solid #d7e0f1;border-right:1px solid #d7e0f1;border-left:1px solid #d7e0f1;width:300px;}
    .classification >div{text-align:center;height:30px;border-right:1px solid #d7e0f1;}
    .classification >div:last-child{border-right:none;}
    .classification .add_active{background:#ecf0f5;border-bottom:1px solid #ecf0f5;}
    .fomr_term{height:30px;line-height:30px;}
    .classification >div,.all_open_order{cursor:pointer;}
    .all_open_order{margin-right:10px;margin-top:5px;}
    .template >div{text-align:center;}
    .template_img{float:left;width:50px;height:50px;overflow:hidden;vertical-align:middle;margin-right:2%;}
    .template_span{display:inline-block;margin-top:2px;}
    .template_btn{padding:1px 8px;border-radius:3px;}
    .form_con,.form_title{height:30px;line-height:30px;}
    .form_con >td,.form_title >th{text-align:center;font-weight:normal;}
    .form_con >td:nth-of-type(1) >img{display:inline-block;width:48px;height:48px;border-radius:50%;border:1px solid #d7e0f1;overflow:hidden;}
    .form_thead >tr,.containers >tr{padding:8px 0;}
    .form_title >th:nth-of-type(2),.form_con >td:nth-of-type(2){flex:1.5;}
    .form_title >th:nth-of-type(7),.form_con >td:nth-of-type(7){flex:2.9;}
    .form_title >th:nth-of-type(6),.form_con >td:nth-of-type(6){flex:2.9;}
    .containers >tr:nth-child(even){background:#F8F8F8 !important;}
    .containers >tr:nth-child(odd){background:#fff !important;}
    .form_con >td{padding-right:20px !important;}
    .box-body{padding:0px;overflow:hidden;}
    #coupons_table_length{display:none;}

    .drow_list{display:none;position:absolute;width:100%;top:100%;left:0;background:#fff;border:1px solid #e4e4e4;padding:0;overflow:auto;z-index:999}
    .drow_list li{height:35px;padding-left:15px;line-height:35px;list-style:none; cursor:pointer}
    .drow_list li:hover{background:#f1f1f1}
    .drow_list li.cur{background:#ff9900;color:#fff}
    #drowdown:hover .drow_list{display:block}
    #selects_membeb{display:inline-block;width:auto;vertical-align:middle;margin-right:25px;}
    #coupons_table_wrapper >.row:first-child{background:#fff;padding:10px;}
    .fixed_box{position:fixed;top:30%;left:48%;z-index:9999;border:1px solid #d7e0f1;border-radius:5px;padding:1% 2%;display:none;}
    .tile{font-size:15px;text-align:center;margin-bottom:4%;}
    .f_b_con{font-size:13px;margin-bottom:8%;}
    .f_b_con span:first-child{display:inline-block;width:80px;text-align:right;margin-right:5px;}
    #notify_center_num >i.pointer,.delivery,.confirms,.cancel{cursor:pointer;}
    .pagination{margin-top:0px;margin-bottom:0px;}
    .btn_list_r span{margin-right:10px;}
    .btn_list_r span:last-child{margin-right:0px;}
    .f_b_con i{right:8px;top:1px;font-style:normal;}
    .table-striped>tbody>tr:nth-of-type(odd) {  background-color: #ffffff;  }
    .color_F99E12 {  margin: 0 5px;  }
    #data-grid_wrapper >.row:first-child{background:#fff;padding:10px;}
    table.dataTable th{background: #f8f9fb;}
    div.dataTables_filter label{text-align:center;width: 50%;}
    .search-wd {  width: 80% !important;  }
    .expot{width: 100%;margin-bottom: 10px;}
    .expot span{display: inline-block;}
    .expot input[type='text']{width:30%;display: inline-block;}
    .expot-control{margin-top: 10px;}
    .expot-control input[type=radio]{height: 14px;}
    table.table-bordered th:last-child, table.table-bordered td:last-child{text-align: center;vertical-align: middle;}
    table.table-bordered td:last-child>.btn-sm{padding:2px 6px;margin: 0 2px;}
    #expot{ display: none;}
    #selects_membeb{display:inline-block;width:auto;vertical-align:middle;margin-right:25px;}
    .table-striped>tbody>tr:nth-of-type(odd) {  background-color: #ffffff;  }
    .color_F99E12 {  margin: 0 5px;  }
    #data-grid_wrapper >.row:first-child{background:#fff;padding:10px;}
    table.dataTable th{background: #f8f9fb;}
    .h_btn_list{display: inline-block}
</style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

<?php
/* 顶部导航 */
echo $block_top;
?>

<?php
/* 左栏菜单 */
echo $block_left;
?>
<div style="color:#92a0ae;">
    <div class="over_x">
        <div class="content-wrapper">
            <div class="banner bg_fff p_0_20"><?=$breadcrumb_array['action']?></div>
            <div class="contents">
                <?=$this->session->show_put_msg()?>
                <div class="flex bd bg_fff center" style="justify-content:space-between;padding:8px 20px;">
                    <div>
                        <div class="color_main h24"><?=isset($result['total'])?floatval($result['total']):0;?></div>
                        <div class="color_999">总领取数量</div>
                    </div>
                    <div>
                        <div class="color_main h24"><?=isset($result['use_num'])?$result['use_num']:0;?></div>
                        <div class="color_999">已使用数量</div>
                    </div>
                    <div>
                        <div class="color_main h24"><?=isset($result['expire_num'])?$result['expire_num']:0;?></div>
                        <div class="color_999">已过期数量</div>
                    </div>
                    <div>
                        <div class="color_main h24"><?=isset($result['useoff_num'])?$result['useoff_num']:0;?></div>
                        <div class="color_999">已核销数量</div>
                    </div>
                    <div>
                        <div class="color_main h24"><?=isset($result['giving_num'])?$result['giving_num']:0;?></div>
                        <div class="color_999">分享已转赠数量</div>
                    </div>
                </div>
                <div class="box-body" style="margin-top: 18px;">
                    <div id="expot">
                        <div class="expot">
                            <div class="expot-control">
                                <input type="radio" checked class="time_mode" name="time_mode" value="1" />
                                <span>领取时间</span>
                                <input type="text" name="start_time" autocomplete="off" class="form-control input-sm date-export1" />
                                <span>至</span>
                                <input type="text" name="end_time" autocomplete="off" class="form-control input-sm date-export2" />
                            </div>

                            <div class="expot-control">
                                <input type="radio" class="time_mode" name="time_mode" value="2" />
                                <span>失效时间</span>
                                <input type="text" name="stime" disabled autocomplete="off" class="form-control input-sm date-export3" />
                                <span>至</span>
                                <input type="text" name="etime" disabled autocomplete="off" class="form-control input-sm date-export4" />
                            </div>
                        </div>
                    </div>
                    <table id="data-grid" class="table-bordered table-striped table-condensed dataTable no-footer">
                        <thead class="bg_f8f9fb form_thead">
                        <tr class="bg_f8f9fb form_title">
                            <?php foreach ($fields_config as $k=> $v):?>
                                <th <?php if(isset($v['grid_width'])) echo 'width="'. $v['grid_width']. '"'; ?> >
                                    <?php echo $v['label'];?>
                                </th>
                            <?php endforeach;?>
                        </tr>
                        </thead>
                        <tfoot class="bg_f8f9fb form_thead">
                        <tr class="bg_f8f9fb form_title">
                            <?php foreach ($fields_config as $k=> $v):?>
                                <th <?php if(isset($v['grid_width'])) echo 'width="'. $v['grid_width']. '"'; ?> >
                                    <?php echo $v['label'];?>
                                </th>
                            <?php endforeach;?>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<?php
/* Footer Block @see footer.php */
require_once VIEWPATH . $tpl . DS . 'privilege' . DS . 'footer.php';
?>

<?php
/* Right Block @see right.php */
require_once VIEWPATH . $tpl . DS . 'privilege' . DS . 'right.php';
?>

<?php
/* Right Block @see right.php */
require_once VIEWPATH . $tpl . DS . 'privilege' . DS . 'commonjs.php';
?>
<script src="<?php echo base_url(FD_PUBLIC) ?>/AdminLTE/plugins/datatables/layDate.js"></script>
<!--日历调用结束-->
<script type="text/javascript">
    ;!function(){
        laydate({
            elem: '#datepicker'
        })
        laydate({
            elem: '#datepicker2'
        })
    }();
</script>
<script type="text/javascript">
    <?php
    $sort_index= $module->field_index_in_grid($default_sort['field'],4);
    $sort_direct= $default_sort['sort'];
    $num= (config_item('grid_static_num'))? config_item('grid_static_num'): 500;
    $buttions= '<div class="actives synchronize" data-action="'.EA_const_url::inst()->get_url('*/memberexport/export').'" data-cid="'.$get['card_id'].'" id="grid-btn-export">导出</div>';	//button之间不能有字符空格，用php组装输出
    $get_param = !empty($_GET)?$_GET:array();
    ?>
    var grid_sort= [[ <?php echo $sort_index ?>, "<?php echo $sort_direct ?>" ]];
    var dataSet= <?php echo json_encode($result['data']); ?>;
    var columnSet= <?php echo json_encode( $model->get_column_config($fields_config) ); ?>;
    var buttons = $('<div class="h_btn_list"><?php echo $buttions; ?></div>');
    var url_add= '<?php echo EA_const_url::inst()->get_url("*/*/add"); ?>';			//跟button对应
    var url_edit= '<?php echo EA_const_url::inst()->get_url("*/*/edit"); ?>';		//跟button对应
    var url_delete= '<?php echo EA_const_url::inst()->get_url("*/*/delete"); ?>';	//跟button对应
    var url_ajax= '<?php echo EA_const_url::inst()->get_url("*/*/card_user_info/".$get['card_id']); ?>';
    var url_extra= [];
</script>
<?php if($result['total']<$num):?>
    <script src="<?php echo base_url(FD_PUBLIC). '/'. $tpl ?>/plugins/datatables/jquery.dataTables.min.js"></script>
<?php else:?>
    <script src="<?php echo base_url(FD_PUBLIC). '/'. $tpl ?>/plugins/datatables/jquery.dataTables.member.min.js"></script>
<?php endif;?>
<script src="<?php echo base_url(FD_PUBLIC). '/'. $tpl ?>/plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="<?php echo base_url(FD_PUBLIC). '/'. $tpl ?>/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- page script -->
<?php
if( floatval($result['total'])<$num)
    require_once VIEWPATH. $tpl .DS .'membervip'. DS. 'membercard'. DS .'indexjs.php';
else
    require_once VIEWPATH. $tpl .DS .'membervip'. DS. 'membercard'. DS. 'indexjs_ajax.php';
?>

<script type="text/javascript">
    $(document).ready(function() {
        var Jobj = {};
        Wind.use("artDialog",function (){
            $(document).on('click','#grid-btn-export',function () {
                var onthis = this,url_action=$(this).data('action');
                var content = $("#expot").html();
                $("#expot").find('.expot').remove();
                var cid = $(this).data("cid");
                art.dialog({
                    title:'信息提示',
                    width:'27%',
                    left:'30%',
                    content:content,
                    ok:function (){
                        var time_mode=0;
                        $("input[name='time_mode']").each(function (index,item) {
                            if(item.checked===true) time_mode=item.value;
                        });

                        if(time_mode=='1'){
                            var start_time = $("input[name='start_time']").val(),end_time = $("input[name='end_time']").val();
                        }else if(time_mode=='2'){
                            var start_time = $("input[name='stime']").val(),end_time = $("input[name='etime']").val();
                        }

                        if(!start_time || start_time==''){
                            art.dialog({title:'提示',content:'请选择开始时间',lock:true,opacity:0.01,background:'#FFF',ok:false,cancel:true,cancelVal:'关闭',time:3});
                            return false;
                        }

                        if(!end_time || end_time==''){
                            art.dialog({title:'提示',content:'请选择结束时间',lock:true,opacity:0.01,background:'#FFF',ok:false,cancel:true,cancelVal:'关闭',time:3});
                            return false;
                        }
                        var sd = new Date(start_time+' 00:00:00'),st=sd.getTime()/1000; //开始时间的时间戳
                        var ed = new Date(end_time+' 24:00:00'),et=ed.getTime()/1000; //结束时间的时间戳
                        var cd = et-st,fm=parseInt((cd/(60*60*24)));  //得出选择时间的间隔天数
                        if(cd<=0){
                            art.dialog({title:'提示',content:'结束时间不能小于开始时间',lock:true,opacity:0.01,background:'#FFF',ok:false,cancel:true,cancelVal:'关闭',time:3});
                            return false;
                        }
                        sd.setDate(32); //设置超出月份范围的数字得出超出的天数,以得出准确的月份总天数
                        var v=sd.getDate(),c=32-v;
                        var c1=31,c2=30,tc=c1+c2+c;
                        if(fm>tc){
                            art.dialog({title:'提示',content:'时间间隔不能大于三个月',lock:true,opacity:0.01,background:'#FFF',ok:false,cancel:true,cancelVal:'关闭',time:3});
                            return false;
                        }

                        art.dialog({content:'正在导出...',lock:true,opacity:0.1,background:'#FFF',ok:false,cancel:true,cancelVal:'关闭',time:6});

                        window.location= url_action+'?cid='+cid+'&bt='+start_time+'&et='+end_time+'&mode='+time_mode;
                    },
                    close:function () {
                        $("#expot").html(content);
                    },
                    cancel:true,
                    follow:onthis,
                    okVal:'导出',
                    cancelVal:'取消'
                });

                $('.date-export1').datetimepicker({
                    format:'Y-m-d',
                    lang:'ch',
                    timepicker:false,
                    scrollInput:false
                });
                $('.date-export2').datetimepicker({
                    format:'Y-m-d',
                    lang:'ch',
                    timepicker:false,
                    scrollInput:false
                });

                $('.date-export3').datetimepicker({
                    format:'Y-m-d',
                    lang:'ch',
                    timepicker:false,
                    scrollInput:false
                });
                $('.date-export4').datetimepicker({
                    format:'Y-m-d',
                    lang:'ch',
                    timepicker:false,
                    scrollInput:false
                });
            });
        });

        $(document).on('click','.time_mode',function () {
            $(this).parent().parent().find("input[type='text']").prop('disabled',true);
            $(this).parent().find("input[type='text']").prop('disabled',false);
        });
    });
</script>
</body>
</html>
