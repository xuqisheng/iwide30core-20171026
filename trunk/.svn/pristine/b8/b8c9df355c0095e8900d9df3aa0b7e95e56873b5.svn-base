<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="<?php echo base_url(FD_PUBLIC) ?>/js/html5shiv.min.js"></script>
    <script src="<?php echo base_url(FD_PUBLIC) ?>/js/respond.min.js"></script>
<![endif]-->
</head>
<!-- 新版本后台 v.2.0.0 -->
<link type="text/css" href="<?php echo base_url(FD_PUBLIC) ?>/soma/css/tao.css" rel="stylesheet">
<script src="<?php echo base_url(FD_PUBLIC) ?>/js/jquery.jedate.min.js"></script>
<link type="text/css" href="<?php echo base_url(FD_PUBLIC) ?>/js/jedate.css" rel="stylesheet">
<style>
.land input,.tk input{
    -webkit-box-sizing: border-box !important;
    -moz-box-sizing: border-box !important;
    box-sizing: border-box !important;
}
.land *,.tk *,.tk,.land{
    -webkit-box-sizing: initial !important;
    -moz-box-sizing: initial !important;
    box-sizing: initial !important;
}
html{
    font-size: 12px !important;
}
    link,script{padding:0 !important; margin:0 !important}
    .form-group {margin-bottom:0}
    .left_part{
                width: 50%;
            }
            .left_part>ib:first-child,.t3{
                width: 80px;
                text-align: right;
                white-space: nowrap;
            }
            .left_part input{
                border:#e5e5e5 1px solid;
                padding: 3px 15px;
            }
            .formdate{
                    padding-right: 30px !important;
    background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABG0lEQVQ4jZ3TQSuEURgF4MfMbaI0TdlbSDY2spbFlBIrsZHUxIqVH8DKStlYKP/AltXsTPEnhLCxsZySkhkW846mz8ynnHrrnHvvOe99u9831Gg0oIwCznGAB/0xiUOso41mwiWqaGEUc8H7oYgRPAe/KoS5jAouMBu8X83GmUp4qim6fUWHtQGdu7jvOfOFVkIJtT+Mg1BKMcvMPwOKCe/Y+2dArZBZWNR5pmLoLWwEL+EUS72GbMAe9jEe+gTHwSewi+1eQ8oE7GIKT6GX8RH8FvO4ywt4jOriOrN/k9G/RtjR+VCGQ5/hKGvKC1jQufZY6FWs5AVkR9gM80voaYP/i5+AFDdp4y2qi9ccbwEpoY4mPvM6DWhe/wZyjzHKkl4epAAAAABJRU5ErkJggg==');
    background-repeat: no-repeat;
    background-position: 96% center;
            }
            .goods_add{
                background-color: #f6f6f6;
                color: #b69b69;
                border:#e5e5e5 1px solid;
                    padding: 8px 15px;
    border-radius: 3px;
    cursor: pointer;
            }
            .land input[type = "radio"]{
                margin-right: 5px;
            }
            .thetable{
                width: 512px;
            }
            .thetable>table{
                width: 100%;
                border-collapse:collapse;border-spacing:0;
                text-align: center;
            }
            .thetable>table th{
                background-color: #eff2f7;
                border: 1px solid #e5e5e5;
                padding: 10px 20px;
                color: #808080;
                text-align: center;
            }
            .thetable>table td{
                border : 1px solid #e5e5e5;
                padding: 10px 0px;
                color: #333;
            }
            .cancel,.save{
                width: 150px;
                height: 40px;
                text-align: center;
                line-height: 40px;
                font-size: 14px;
                border-radius: 5px;
                cursor: pointer;
            }
            .cancel{
                border:#bfbfbf 1px solid;
                color: #808080;
                background-color: white;
            }
            .save,.setprice,.search{
                background-color: #b69b69;
                border:1px solid #b69b69;
                color: white;
            }
            .setprice{
                border-radius: 3px;
                padding: 5px 8px;
                cursor: pointer;
            }
            .search{
                border-radius: 3px;
                padding: 0px 20px;
                cursor: pointer;
                font-size: 12px;
                height: 28px;
                line-height: 28px;
            }
            .the_search{
                background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAACOUlEQVRIia3VS4iNcRgG8N85rjELcplBkVwiQ0oUSkhkQWwUYuWymbJDoQkrViT3rSSSSyQLncxC45J7Lgs2LjMLl5SJMMbiez/nc3wj5ng253nf7/9/nv/tvG+hVCrpBLVYgQWoj/gbWnAbF3AKbZ0JQCHHoAabsSH4n9CCnTiC9rwB3SvicTiPMZncB1wLse4YjunohSE4gEVYHmM7NRiPqxgU8QNswyV8qZhXg5VoDJOFaMIMFUdWzEw4mxHfjyk4lyMOH3FYcjeXIzcJx1DIM9iIscEPogFfc4Qr8Q6LkV7kEizNDiiUSqXBeI6+eBgrz1v1n1CHx+iHJ5iA7+kOVoY4bO2COLRib/BxmJV+KGJ+8DeSt91VnMjwVFMRo4Lf0Mlb/ks8wcvgk7IGw4K3VCGe4kX8DswapK+l238wSDV+nkQRr4OPqFK8oHzcrVmDR8Gnok8VBtMwIPjtrMHF4Onfv6tYneGppiJOKm+pUblc/AvqsTZ4E+5mDdqwPeJhkvfc6x/EB+MMeqADm7If01p0VFI1YS6uYOhfiE9GM0ZHvDvi3wzaJfX8XsQz8RQ7lItgioLkQo/iJkZG/jS2oHeeAUmzmOPXS98WRi24hft4i+tYo9xPdmFZmHzCnljILwbwXtKdVuFZJl8nqbIT0T+Tb45FbUZPSekmabeHUKhsmSQXdQzHMRvzQrhWcpSvcCd2ejcz77OkUTVEvA5teU2/GhQknS59sh/zdlANOrBe0lLXYd8PUbN8XBar6NgAAAAASUVORK5CYII=) no-repeat scroll right center white;
                font-size:12px;width: 300px;padding: 0px 15px;margin-right: 10px;
                height: 30px;
                line-height: 30px;
                background-size: 12px;
                background-position-x:90%;
                position: relative;
            }
            :-moz-placeholder {
        /* Mozilla Firefox 4 to 18 */
        color: #bfbfbf;
    }
    
    ::-moz-placeholder {
        /* Mozilla Firefox 19+ */
        color: #bfbfbf;
    }
    
    input:-ms-input-placeholder {
        color: #bfbfbf;
    }
    
    input::-webkit-input-placeholder {
        color: #bfbfbf;
    }
            .the_footer{
                width: 325px;
            }
            .muta::before{
                content: "*";
                color: red;
                margin-right: 5px;
            }
            .tk{
                position: fixed;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.3);
                top: 0px;
                left: 0px;
                text-align: center;
                font-size: 12px;
                z-index: 999999999;
            }
            .tk_body{
                width: 650px;
                background-color: white;
                padding: 10px 120px;
                border-radius: 5px;
                margin:auto;
                position: relative;
            }
            .line1{
                padding: 12px;
                background-color: #f6f6f6;
            }
            .table2 {
                max-height: 400px;
                overflow: auto;
            }
            .table2 td{
                text-align: left;
            }
            .table2 td>div{
                position: relative;
                margin: 10px 0px;
            }
            .table2 td>div>ib:first-child{
                width: 40%;
                text-align: right;
            }
            .tk_btn{
                width: 300px;
                height: 40px;
                text-align: center;
                line-height: 40px;
                font-size: 14px;
                border-radius: 5px;
                background-color: #b69b69;
                border:1px solid #b69b69;
                color: white;
                margin-bottom: 20px;
                cursor: pointer;
            }
            X {
                    position: absolute;
    top: 20px;
    right: 20px;
            }
            .land select{
                border:#eee 1px solid;
                    width: 90px;
    height: 24px;
    background-color: white;
            }
            .land .thetable input{
                    border: 1px solid #eee;
    width: 80px;
    padding: 2px 0px;
            }
            .tk input[type="checkbox"]{
                margin-top: 0px !important;
                -webkit-appearance:none;
                -moz-appearance:none;
                -o-appearance:none;
                appearance:none;
                width: 14px;
                height: 14px;
                vertical-align: middle;
                border:1px solid #bfbfbf;
                margin-right: 15px;
                border-radius: 2px;
                cursor: pointer;
                outline: none;
            }
            .checked{
                -webkit-appearance:none;
                -moz-appearance:none;
                -o-appearance:none;
                appearance:none;
                width: 14px;
                height: 14px;
                vertical-align: middle;
                background-color: #b69b69;
                border:1px solid #b69b69;
                color: white;
                position: relative;
            }
            .checked::after{
                content: "";
                position: absolute;
                left: 20%;
                top: 20%;
                width: 60%;
                height: 60%;
                color: white;
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAAzElEQVQokZ3RIUvDURTG4SuCQQQtNpt+AMOKsCQYVtb9AEs2q1/AbLfbDObFgRgEkYXBwrLJIYKK+FjOxcP2d7C9cODc95zfvYdzC8oKcYEPXK0Cn/vTdFm4h590weUy8Cm+E3yNtYIzPKCzAO7iK8E3WEcpeAvzEycN8HEsrOoOG7VecJuK72gn+Ci8qj428wMljEFqekULh5FX3WNrdsKabOMxNb9EVD1hp2k/+bCLoXmNota44FljD+MET8L793ubzP0Y+RkHi2CUXxoTeqJ73a4lAAAAAElFTkSuQmCC);
                text-align: center;
                line-height: 12px;
                background-size: 100% 100%;
            }
            .tk input[type="checkbox"]:checked{
                -webkit-appearance:none;
                -moz-appearance:none;
                -o-appearance:none;
                appearance:none;
                width: 14px;
                height: 14px;
                vertical-align: middle;
                background-color: #b69b69;
                border:1px solid #b69b69;
                color: white;
                position: relative;
            }
            .tk input[type="checkbox"]:checked::after{
                content: "";
                position: absolute;
                left: 20%;
                top: 20%;
                width: 60%;
                height: 60%;
                color: white;
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAAzElEQVQokZ3RIUvDURTG4SuCQQQtNpt+AMOKsCQYVtb9AEs2q1/AbLfbDObFgRgEkYXBwrLJIYKK+FjOxcP2d7C9cODc95zfvYdzC8oKcYEPXK0Cn/vTdFm4h590weUy8Cm+E3yNtYIzPKCzAO7iK8E3WEcpeAvzEycN8HEsrOoOG7VecJuK72gn+Ci8qj428wMljEFqekULh5FX3WNrdsKabOMxNb9EVD1hp2k/+bCLoXmNota44FljD+MET8L793ubzP0Y+RkHi2CUXxoTeqJ73a4lAAAAAElFTkSuQmCC);
                text-align: center;
                line-height: 12px;
                background-size: 100% 100%;
            }
            .land input[type="radio"]{
                margin-top: 0px !important;
                border-radius: 0px;
                -webkit-appearance:none;
                -moz-appearance:none;
                -o-appearance:none;
                appearance:none;
                padding: 0px !important;
                width: 14px !important;
                height: 14px !important;
                border: 1px solid #c1c1c1;
                border-radius: 100%;
                vertical-align: middle;
                cursor: pointer;
                outline: none;
            }
            .land input[type="radio"]:checked{
                -webkit-appearance:none;
                -moz-appearance:none;
                -o-appearance:none;
                appearance:none;
                padding: 0px !important;
                width: 14px !important;
                height: 14px !important;
                border: 1px solid #b69b69;
                border-radius: 100%;
                vertical-align: middle;
                position: relative;
            }
            .land input[type="radio"]:checked::after{
                content: "";
                position: absolute;
                width: 50%;
                height: 50%;
                left: 25%;
                top: 25%;
                background-color: #b69b69;
                border-radius: 100%;
            }
            .tk h1{
                font-size: 16px;
                margin-bottom: 35px;
                color: #333;
            }

            .jedateblue .jedaul li.other, .jedateblue .jedaul li.other .nolunar, .jedateblue .jedaul li.other .lunar {
    color: #bfbfbf !important;
}
.jedateblue .jedaul li.action, .jedateblue .jedaul li.action:hover, .jedateblue .jedaul li.action .lunar {
    background: #b69b69 !important;
}
.jedateblue .jedatebot .jedatebtn span {
    background-color: #b69b69 !important;
    cursor: pointer;
}
.jedateblue .jedatetop {
    background: #b69b69 !important;
}
.jedateblue {
    border: 1px #b69b69 solid !important;
}
.jedateblue .jedatehmstitle {
    background: #b69b69 !important;
}
.jedateblue .jedatehmscon p.action, .jedateblue .jedatehmscon p.action:hover {
    background: #b69b69 !important;
}
.jedateblue .jedateym .triangle:hover {
    background-color: #d8c67c !important;
}
.jedatebox .jedatehmscon::-webkit-scrollbar-thumb{background: #bfbfbf !important; }
.jedatebox .jedatehmscon::-webkit-scrollbar-thumb:hover{background:#bfbfbf !important}
.jedatebox .jedatehmscon::-webkit-scrollbar-thumb:active{background:#bfbfbf !important}
.jedatebox .jedatehmscon::-webkit-scrollbar-thumb:window-inactive {background: #bfbfbf !important;}
.jedatetopym .action,.jedatetopym .jedateymchok{background:#b69b69 !important}
.alert{
    margin-bottom: 10px;background-color: #fff4e2;padding: 15px 30px;border: 1px solid #fde7ba;
    animation: 1s show;
    -webkit-animation: 1s show;
}
@keyframes show{
    from{
        padding: 0px 30px;
    }
    to{
        padding: 15px 30px;
    }
}
@-webkit-keyframes show{
    from{
        padding: 0px 30px;
    }
    to{
        padding: 15px 30px;
    }
}
</style>
<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">

        <?php
        /* 顶部导航 */
        echo $block_top;
        ?>

        <?php
        /* 左栏菜单 */
        echo $block_left;
        ?>

        <div class="content-wrapper">
            <section class="content">
                <?php echo $this->session->show_put_msg(); ?>
                <form class="the_form" action="<?php echo Soma_const_url::inst()->get_url('*/*/edit_post'); ?>" method="post">
                    <div class="land alert none">
                        <div style="display: flex;align-items: center;justify-content: space-between;">
                            <ib>
                            <ib style="width: 20px;height: 20px;margin-right: 20px;"><img style="float: left;" class="w100" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTU2REFBM0I0MzY4MTFFN0IzODlERTQwRDE5MTYwRTIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NTU2REFBM0M0MzY4MTFFN0IzODlERTQwRDE5MTYwRTIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGQTAyQUU1MDQzNUExMUU3QjM4OURFNDBEMTkxNjBFMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1NTZEQUEzQTQzNjgxMUU3QjM4OURFNDBEMTkxNjBFMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pnz0sgwAAAK/SURBVHjazFg9TBRBFL5blAojFGBPciit0crETkiusKAASqTSEwETEgsTSEgsTIzicXdoRaggFBYUlyg2/nQKpeYgsZefABEShHDnN8m3yXMyezNzxyb3ki/zdnbmvW/ezM682WSlUkk0glyo18DW3WRd/TtWKv5E4PQiil7gDnAT6ARa+Xof+AV8A1aB98Cpq+2ky9SAgHI2DmSAdkfbO0AemCHJqhGxEgGJQRq7UmP0f3MQSzVNDQg0oZgFHmivSsA88JlTEY62lVN1GxgCrrFeDWCR9Y+AM+epIYlloE9Ub3JkRcdIpBnJlKh7B/RLMmFEgggjMxqJAkdY9JiSIvsURJ2y+drUODBEYwDFiKiaAh4C5RrWR5l9p0Sdeh6oSoRfR1ZUvQWmLc6eAX9YRomy8UY8Z8Vnb4yIWgMd1DfI3iZPgBZgwtJuhDYT9DFuJIJoNHOfCOVx1ArXpIlls6XdGW2GkpF9ZER6xGZV8lyYPgu4RL2dPo1EQpmP8XyTtntNRK4L/WuMRL6YfEoiXULfiJHIptBTJiKXhX4QI5EDk88g0SAS2JjGIMbIB7a5c5BwrzlxbJ8y+ZRE1oR+y4PIc+AQeOHYXtpeNxH5KPR7HkSeApdYusiw0FdNRD4Au9S7mU+ct6RFwrRDn/8TQYJyjCInOr0S50i9p2/o66V4VvnscdTnqxKiLbHB5RyITPD0HbW0U46vUt+mL3MagKjsawbvA5MWB2qRHml5jC6TtBXKqJ7ZR+WsOS0XKTDxLdewT81q6UVeZoC2nHWMia7MHX54LuA0+2S05HnM64JV5TrxE1gAPvE6scf6Nu060a31mzNdJ3wvWFmPG54u21wTVS9Y1kMPDZf4BU2LfcZFdtmnK4qE991Xy2t7mFnd4FS08fUep+o7NyqFv65/A5L1/h85r98SDZOP/BNgAJKAw8d2jWFaAAAAAElFTkSuQmCC"></ib>
                            <ib class="alertmsg">111111</ib>
                            </ib>
                            <ib class="alertclose" style="font-size: 14px;cursor: pointer;">╳</ib>
                        </div>
                    </div>
                    <div class="land">
                        <cutline data-name="活动配置"></cutline>
                        <div mt-30>
                            <if class="left_part">
                                <ib class="muta">名称</ib>
                                <ib ml-20><input name="name" required value="<?php echo isset($data['name']) ? $data['name'] : '';?>"></ib>
                            </if>
                            <if>
                                <ib>类型</ib>
                                <?php $scope = isset($data['scope']) ? $data['scope'] : 0;?>
                                <?php if($typeList):?>
                                    <?php foreach($typeList as $k=>$v):?>
                                        <ib ml-20><input name="scope" type="radio" checked value="<?php echo $k;?>" <?php if($scope==$k) echo 'checked';?> /><?php echo $v;?></ib>
                                    <?php endforeach;?>
                                <?php endif;?>
                            </if>
                        </div>
                        <cutline mt-30 data-name="批量价格配置"></cutline>
                        <div mt-30>
                            <if class="left_part">
                                <ib>适用商品</ib>
                                <ib ml-20 class="goods_add" onclick="add()">+添加</ib>
                            </if>
                            <if>
                                <ib class="muta">限购</ib>
                                <?php $limitNum = isset($data['extra']['limit_num']) ? $data['extra']['limit_num'] : '';?>
                                <ib ml-20><input name="goods_limit" type="radio" <?php if($limitNum===0) echo 'checked';?> />无限购</ib>
                                <ib ml-20><input name="goods_limit" type="radio" <?php if($limitNum>0) echo 'checked';?> />每个商品限购份数</ib>
                                <ib ml-20 class="xg_number"><input name="limit_num" value="<?php echo $limitNum==0?'':$limitNum;?>" style="margin-right: 5px;width: 70px;padding: 5px 10px;border:1px solid #e5e5e5">份</ib>
                            </if>
                        </div>
                        <div mt-30>
                            <if class="left_part">
                                <ib>微信价基础上</ib>
                                <?php $fourRule = isset($data['extra']['four_rules']['four_rule']) ? $data['extra']['four_rules']['four_rule'] : 0;?>
                                <ib ml-20><input class="wxj" name="four_rule" type="radio" value="1" <?php if($fourRule==1) echo 'checked';?> />加</ib>
                                <ib ml-20><input class="wxj" name="four_rule" type="radio" value="2" <?php if($fourRule==2) echo 'checked';?> />减</ib>
                                <ib ml-20><input class="wxj" name="four_rule" type="radio" value="3" <?php if($fourRule==3) echo 'checked';?> />乘</ib>
                                <ib ml-20><input class="wxj" name="four_rule" type="radio" value="4" <?php if($fourRule==4) echo 'checked';?> />除</ib>
                            </if>
                            <if>
                                <ib>数值</ib>
                                <?php $floatNum = isset($data['extra']['four_rules']['float_num']) ? $data['extra']['four_rules']['float_num'] : '';?>
                                <ib ml-20><input maxlength="4" name="float_num" class="wxj_num" value="<?php echo $floatNum;?>" style="margin-right: 5px;width: 70px;padding: 5px 10px;border:1px solid #ededed"></ib>
                            <ib ml-20 class="setprice">确认</ib>
                            </if>
                        </div>
                        <div mt-30>
                            <ib>
                                <ib class="t3 muta" style="vertical-align: top;">商品内容</ib>
                                <ib ml-20 class="thetable settable">
                                    <table>
                                        <tr>
                                            <th>分类</th>
                                            <th>商品名称</th>
                                            <th>商品规格</th>
                                            <th>价格</th>
                                            <th>专属价</th>
                                        </tr>
                                        <input name="config" required class="none hidden_input" type="text">
                                    </table>
                                </ib>
                            </ib>
                        </div>
                        <cutline mt-30 data-name="时间配置"></cutline>
                        <div mt-30>
                            <if class="left_part">
                                <ib class="muta">开始时间</ib>
                                <ib ml-20><input required placeholder="YYYY-MM-DD hh:mm:ss" class="formdate" name="start_time" value="<?php echo isset($data['start_time']) ? $data['start_time'] : '';?>"></ib>
                            </if>
                            <if>
                                <ib>状态</ib>
                                <ib ml-20>
                                    <select name="status">
                                        <?php $status = isset($data['status']) ? $data['status'] : 0;?>
                                        <?php if($statusList):?>
                                            <?php foreach($statusList as $k=>$v):?>
                                                <option required value="<?php echo $k;?>" <?php if($status==$k) echo 'selected';?> /><?php echo $v;?></option>
                                            <?php endforeach;?>
                                        <?php endif;?>
                                    </select>
                                </ib>
                            </if>
                        </div>
                        <div mt-30>
                            <if class="left_part">
                                <ib class="muta">失效时间</ib>
                                <ib ml-20><input required placeholder="YYYY-MM-DD hh:mm:ss" class="formdate" name="end_time" value="<?php echo isset($data['end_time']) ? $data['end_time'] : '';?>"></ib>
                            </if>
                        </div>
                        <div mt-30 center>
                            <if around class="the_footer">
                                <ib class="cancel">取消</ib>
                                <input type="hidden" name="<?php echo $this->security->get_csrf_token_name();?>" value="<?php echo $this->security->get_csrf_hash();?>">
                                <input type="hidden" name="id" value="<?php echo isset($data['id']) ? $data['id'] : '';?>">
                                <ib class="save">保存</ib>
                            </if>
                        </div>
                    </div>
                </form>
            </section>
        </div><!-- /.content-wrapper -->
        <flex class="tk none">
                    <div class="tk_body">
                        <h1>添加商品</h1>
                        <flex class="line1" around>
                            <!-- <ib>
                                <ib><input type="checkbox" name="add_goods"></ib>
                                <ib ml-20>全部商品</ib>
                            </ib> -->
                            <ib><input class="the_search" type="text" placeholder="输入商品名称"></ib>
                            <ib class="search">搜索</ib>
                        </flex>
                        <div mt-40>
                            <div class="thetable table2" style="width: auto">
                                <table>
                                <tr>
                                    <th>分类</th>
                                    <th>商品名称</th>
                                    <th>商品规格</th>
                                </tr>
                            </table>
                            </div>
                        </div>
                        <div mt-40 center>
                            <ib class="tk_btn">确认</ib>
                        </div>
                        <X onclick="close();"></X>
                    </div>
                </flex>
    </div>
<?php
/* Footer Block @see footer.php */
require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'footer.php';
?>
<?php 
/* Right Block @see right.php */
require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'right.php';
?>
</div><!-- ./wrapper -->
<?php 
/* Right Block @see right.php */
require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'commonjs.php';
?>
<script>
$(".formdate").jeDate({
    skinCell:"jedateblue",                      //日期风格样式，默认蓝色
    format:"YYYY-MM-DD hh:mm:ss",               //日期格式
    minDate:"1900-01-01 00:00:00",              //最小日期
    maxDate:"2099-12-31 23:59:59",              //最大日期
    language:{                                  //多语言设置
        name  : "cn",
        month : ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"],
        weeks : [ "日", "一", "二", "三", "四", "五", "六" ],
        times : ["小时","分钟","秒数"],
        clear : "清空",
        today : "今天",
        yes   : "确定",
        close : "关闭"
    },
    choosefun: function(){
        return;
    }
});
$(".search").on("click",function(){
                var the_search = $(".the_search").val();
                if(the_search == "" || !the_search){
                    set_addgoods(the_cate,the_product,the_setting);
                }else{
                    search(the_search);
                }
            });
            var the_cate_search = [];
            var the_product_search = [];
            var the_setting_search = [];
            function search(e){
                the_cate_search = [];
                the_product_search = [];
                the_setting_search = [];
                for(var i = 0;i<the_cate.length;i++){
                    if(pp(the_cate[i].cate_name,e)){
                        sameid(the_cate[i].cate_id);
                    }
                    if(the_cate[i].checked){
                        the_cate_search.push(the_cate[i]);
                    }
                }
                for(var i =0;i<the_product.length;i++){
                    if(pp(the_product[i].product_name,e)){
                        sameid3(the_product[i].cate_id,the_product[i].product_id);
                    }
                    if(the_product[i].checked){
                        the_product_search.push(the_product[i]);
                    }
                }
                for(var i =0;i<the_setting.length;i++){
                    if(pp(the_setting[i].setting_name,e)){
                        sameid2(the_setting[i].cate_id,the_setting[i].product_id,the_setting[i].setting_id);
                    }
                    if(the_setting[i].checked){
                        the_setting_search.push(the_setting[i]);
                    }
                }
                set_addgoods(remove(the_cate_search),remove(the_product_search),remove(the_setting_search));
            }
            function sameid(id){
                for(var i = 0;i<the_cate.length;i++){
                    if(the_cate[i].cate_id == id){
                        the_cate_search.push(the_cate[i]);
                    }
                }
                for(var i = 0;i<the_product.length;i++){
                    if(the_product[i].cate_id == id){
                        the_product_search.push(the_product[i]);
                    }
                }
                for(var i = 0;i<the_setting.length;i++){
                    if(the_setting[i].cate_id == id){
                        the_setting_search.push(the_setting[i]);
                    }
                }
                for(var i = 0;i<the_cate.length;i++){
                    if(the_cate[i].product_id == id){
                        the_cate_search.push(the_cate[i]);
                    }
                }
                for(var i = 0;i<the_product.length;i++){
                    if(the_product[i].product_id == id){
                        the_product_search.push(the_product[i]);
                    }
                }
                for(var i = 0;i<the_setting.length;i++){
                    if(the_setting[i].product_id == id){
                        the_setting_search.push(the_setting[i]);
                    }
                }
            }
            function sameid2(id,id2,id3){
                for(var i = 0;i<the_cate.length;i++){
                    if(the_cate[i].cate_id == id){
                        the_cate_search.push(the_cate[i]);
                    }
                }
                for(var i = 0;i<the_product.length;i++){
                    if(the_product[i].product_id == id2){
                        the_product_search.push(the_product[i]);
                    }
                }
                for(var i = 0;i<the_setting.length;i++){
                    if(the_setting[i].setting_id == id3){
                        the_setting_search.push(the_setting[i]);
                    }
                }
            }
            function sameid3(id,id2){
                for(var i = 0;i<the_cate.length;i++){
                    if(the_cate[i].cate_id == id){
                        the_cate_search.push(the_cate[i]);
                    }
                }
                for(var i = 0;i<the_product.length;i++){
                    if(the_product[i].product_id == id2){
                        the_product_search.push(the_product[i]);
                    }
                }
                for(var i = 0;i<the_setting.length;i++){
                    if(the_setting[i].product_id == id2){
                        the_setting_search.push(the_setting[i]);
                    }
                }
            }
            function remove(e){
                var newarr = [e[0]];
                for(var i = 1;i<e.length;i++){
                    var repeat = false;
                    for(var j=0;j<newarr.length;j++){
                        if(newarr[j] == e[i]){
                            repeat = true;
                            break;
                        }
                    }
                    if(!repeat){
                        newarr.push(e[i]);
                    }
                }
                return newarr;
            }
            function pp(str1,str2){
                if(str1 == "" || str1 == null){
                    return false;
                }
                return str1.indexOf(str2) >= 0
            }
            var the_cate = [
//                {
//                    cate_id:666,   //分类ID
//                    cate_name:"餐饮",
//                    checked : true
//                },
                <?php if( $the_cate ):?>
                    <?php
                        foreach( $the_cate as $k=>$v )
                        {
                            echo json_encode($v),',';
                        }
                    ?>
                <?php endif;?>
            ]
            var the_product = [
//                {
//                    cate_id:666,
//                    product_id:1,
//                    product_name:"自助餐",
//                    checked : true,
//                },
                <?php if( $the_product ):?>
                    <?php
                        foreach( $the_product as $k=>$v )
                        {
                            echo json_encode($v),',';
                        }
                    ?>
                <?php endif;?>
            ]
            var the_setting = [
//                {
//                    cate_id:666,
//                    product_id:1,
//                    setting_id:11873,
//                    setting_name:"成人票",
//                    order_price : 123,
//                    price : 123,
//                    checked : false,
//                },
                <?php if( $the_setting ):?>
                    <?php
                        foreach( $the_setting as $k=>$v )
                        {
                            echo json_encode($v),',';
                        }
                    ?>
                <?php endif;?>
            ]
            function set_addgoods(e,e2,e3){
                $(".table2 table").html('<tr><th>分类</th><th>商品名称</th><th>商品规格</th></tr>');
                for(var i = 0 ; i < e.length ; i++){
                    var table2 = document.querySelector(".table2 table");
                    var cate_id = e[i].cate_id;
                    var cate_name = e[i].cate_name;
                    var catelength = e2.length;
                    var cate_checked = e[i].checked;
                    var q = e2;
                    var theswitch = true;
                    for(var j = 0 ; j < q.length ; j++){
                        if(q[j].cate_id == cate_id){
                            var tr = document.createElement("tr");
                            tr.dataset.id = cate_id;
                            tr.dataset.type = cate_name;
                            if(theswitch){
                                var td = document.createElement("td");
                                var therowspan = 0;
                                for(var k = 0;k<q.length;k++){
                                    if(q[k].cate_id == cate_id){
                                        therowspan++;
                                    }
                                }
                                td.rowSpan = therowspan;
                                if(cate_checked){
                                    td.innerHTML = '<div><ib><input data-type="main" checked="checked" type="checkbox"></ib><ib>'+cate_name+'</ib></div>';
                                }else{
                                    td.innerHTML = '<div><ib><input data-type="main" type="checkbox"></ib><ib>'+cate_name+'</ib></div>'
                                }
                                tr.appendChild(td);
                                theswitch = false;
                            }
                            var td2 = document.createElement("td");
                                var ck = q[j].checked ? "checked='checked'" : "";
                                var cp = q[j].price ? 'data-price='+q[j].order_price+' data-zs='+q[j].price+'' : ""
                                var ci = q[j].checked_id ? 'data-checked_id='+q[j].checked_id : "";
                                td2.innerHTML = '<div><ib><input data-id='+q[j].product_id+' data-type="name" '+ck+' type="checkbox" '+ci+'  '+cp+' data-name='+q[j].product_name+'></ib><ib>'+q[j].product_name+'</ib></div>';
                                tr.appendChild(td2);
                                if(e3 != ""){
                                    var z = e3;
                                    var td3 = document.createElement("td");
                                    for(var o = 0 ; o < z.length ; o ++){
                                        var ck2 = z[o].checked ? "checked='checked'" : "";
                                        if(z[o].cate_id == cate_id && z[o].product_id == q[j].product_id){
                                        td3.innerHTML = td3.innerHTML + '<div><ib><input data-id='+z[o].setting_id+' '+ck2+'data-price='+z[o].order_price+' data-zs='+z[o].price+' data-type="info" type="checkbox" data-name='+z[o].setting_name+' data-checked_id='+z[o].checked_id+'></ib><ib>'+z[o].setting_name+'</ib></div>';
                                        }
                                    }
                                }else{
                                    var td3 = document.createElement("td");
                                }
                                tr.appendChild(td3);
                            table2.appendChild(tr);
                        }
                    }
                }
            }   
            set_addgoods(the_cate,the_product,the_setting);
            var x = document.querySelector("X");
            var tk = document.querySelector(".tk");
            function add(argument) {
                tk.className = "tk";
            }
            x.addEventListener("click",function(){
                close();
            });
            function close(e){
                tk.className = "tk none";
            }
            $(document).on("change",".table2 input",function(){
                var type = this.dataset.type;
                var checked = this.checked;
                var tr_type = $(this).parents("tr")[0].dataset.id;
                if(type == "main"){
                    if(checked){
                        $(this).attr({checked:true}).addClass("checked");
                        $("tr[data-id="+tr_type+"]").find("input[type='checkbox']").attr({checked:true}).addClass("checked");
                        setcheck(the_cate,"cate_id",tr_type,true);
                        setcheck(the_product,"cate_id",tr_type,true);
                        setcheck(the_setting,"cate_id",tr_type,true);
                    }else{
                        $(this).attr({checked:false}).removeClass("checked");
                        $("tr[data-id="+tr_type+"]").find("input[type='checkbox']").attr({checked:false}).removeClass("checked");
                        setcheck(the_cate,"cate_id",tr_type,false);
                        setcheck(the_product,"cate_id",tr_type,false);
                        setcheck(the_setting,"cate_id",tr_type,false);
                    }
                }else if(type == "name"){
                    if(checked){
                        $(this).attr({checked:true}).addClass("checked");
                        $("tr[data-id="+tr_type+"]").find("input[data-type='main']").attr({checked:true}).addClass("checked");
                        $(this).parents("tr").find("input[data-type='info']").attr({checked:true}).addClass("checked");
                        setcheck(the_cate,"cate_id",tr_type,true);
                        setcheck(the_product,"product_id",this.dataset.id,true);
                        setcheck(the_setting,"product_id",this.dataset.id,true);
                    }else{
                        $(this).attr({checked:false}).removeClass("checked");
                        $(this).parents("tr").find("input[data-type='info']").attr({checked:false}).removeClass("checked");
                        setcheck(the_product,"product_id",this.dataset.id,false);
                        setcheck(the_setting,"product_id",this.dataset.id,false);
                    }
                }else if(type == "info"){
                    if(checked){
                        $(this).attr({checked:true}).addClass("checked");
                        $("tr[data-id="+tr_type+"]").find("input[data-type='main']").attr({checked:true}).addClass("checked");
                        $(this).parents("tr").find("input[data-type='name']").attr({checked:true}).addClass("checked");
                        setcheck(the_cate,"cate_id",tr_type,true);
                        setcheck(the_product,"product_id",$(this).parents("tr").find("input[data-type='name']")[0].dataset.id,true);
                        setcheck(the_setting,"setting_id",this.dataset.id,true);
                    }else{
                        $(this).attr({checked:false}).removeClass("checked");
                        setcheck(the_setting,"setting_id",this.dataset.id,false);
                    }
                }
            });
            $(".tk_btn").on("click",function(){
                var info = $("[data-type='info'][checked]");
                var name = $("[data-type='name'][checked][data-price]");
                if(info.length == 0 && name.length == 0){
                    settable([]);
                }else{
                    var arr = [];
                    for(var i = 0 ; i<info.length;i++){
                        var tr_type = $(info[i]).parents("tr")[0].dataset.type;
                        var cate_id = $(info[i]).parents("table").find("tr[data-type="+tr_type+"]")[0].dataset.id;
                        var product_id = $(info[i]).parents("tr").find("input[data-name]")[0].dataset.id;
                        var setting_id = info[i].dataset.id;
                        var product_price = info[i].dataset.price;
                        var price = info[i].dataset.zs;
                        var checked_id = info[i].dataset.checked_id;
                        var product_name = $("input[data-id="+product_id+"]")[0].dataset.name;
                        var setting_name = info[i].dataset.name;
                        var x = {
                            cate_id:cate_id,   //分类ID
                            product_id:product_id,  //商品ID
                            setting_id:setting_id,  //规格ID
                            product_price:product_price,  //商品价格
                            price:price,    //专属价格
                            cate_name:tr_type, //分类名称
                            product_name:product_name, //商品名称
                            setting_name:setting_name, //规格名称
                            checked_id : checked_id //检查字段
                        }
                        arr.push(x);
                    }
                    for(var i = 0 ; i<name.length;i++){
                        var tr_type = $(name[i]).parents("tr")[0].dataset.type;
                        var cate_id = $(name[i]).parents("table").find("tr[data-type="+tr_type+"]")[0].dataset.id;
                        var product_id = name[i].dataset.id;
                        var setting_id = "null";
                        var product_price = name[i].dataset.price;
                        var price = name[i].dataset.zs;
                        var checked_id = name[i].dataset.checked_id;
                        var product_name = name[i].dataset.name;
                        var setting_name = "";
                        var x = {
                            cate_id:cate_id,   //分类ID
                            product_id:product_id,  //商品ID
                            setting_id:setting_id,  //规格ID
                            product_price:product_price,  //商品价格
                            price:price,    //专属价格
                            cate_name:tr_type,  //分类名称
                            product_name:product_name, //商品名称
                            setting_name:setting_name, //规格名称
                            checked_id : checked_id //检查字段
                        }
                        arr.push(x);
                    }
                    settable(arr);
                }
            });
            $(".tk_btn").click();
            function setcheck(arr,type,id,value){
                for(var i=0;i<arr.length;i++){
                    if(arr[i][type] == id){
                        arr[i].checked = value;
                    }
                }
            }
            function settable(e){
                var thehtml = '<tr><th>分类</th><th>商品名称</th><th>商品规格</th><th>价格</th><th>专属价</th></tr>';
                for(var i = 0 ; i < e.length;i++){
                    thehtml = thehtml + '<tr data-checked_id='+e[i].checked_id+' data-cate_id='+e[i].cate_id+' data-setting_id='+e[i].setting_id+' data-product_id='+e[i].product_id+'><td>'+e[i].cate_name+'</td><td>'+e[i].product_name+'</td><td>'+e[i].setting_name+'</td><td>'+e[i].product_price+'</td><td><input type="text" center value='+e[i].price+'></td></tr>'
                }
                $(".settable table").html(thehtml);
                tk.className = "tk none";
            }
            $(".setprice").on("click",function(){
                var type = $(".wxj:checked").val();
                var number = parseFloat($(".wxj_num").val());
                var all = $(".settable input");
                var all_price = $(".settable td:nth-child(4)");
                switch(type){
                    case "1":
                        for(var i=0;i<all_price.length;i++){
                            var newprice = parseFloat(all_price[i].innerHTML);
                            var result = newprice+number;
                            $(all_price[i].nextElementSibling).find("input").val(result.toFixed(2));
                        }
                        break;
                    case "2":
                        for(var i=0;i<all_price.length;i++){
                            var newprice = parseFloat(all_price[i].innerHTML);
                            var result = newprice-number;
                            $(all_price[i].nextElementSibling).find("input").val(result.toFixed(2));
                        }
                        break;
                    case "3":
                        for(var i=0;i<all_price.length;i++){
                            var newprice = parseFloat(all_price[i].innerHTML);
                            var result = newprice*number;
                            $(all_price[i].nextElementSibling).find("input").val(result.toFixed(2));
                        }
                        break;
                    case "4":
                        for(var i=0;i<all_price.length;i++){
                            var newprice = parseFloat(all_price[i].innerHTML);
                            var result = newprice/number;
                            $(all_price[i].nextElementSibling).find("input").val(result.toFixed(2));
                        }
                        break;
                }
            });
            $(".save").on("click",function(){
                var ajson = {}
                var tr = $(".settable tr");
                if(tr.length <= 1){
                    _alert("带*为必填项，请填写后保存");
                    return;
                }
                for(var i = 1 ; i<tr.length;i++){
                    var cate_id = tr[i].dataset.cate_id;
                    var product_id = tr[i].dataset.product_id;
                    var setting_id = tr[i].dataset.setting_id;
                    var checked_id = tr[i].dataset.checked_id;
                    var sz = $(tr[i]).find("input").val();
                    if(sz == "" || !sz){
                        _alert("配置价格不能为空");
                        return;
                    }
                    ajson[i] = {
                        cate_id : cate_id,
                        product_id : product_id,
                        setting_id : setting_id,
                        price : sz,
                        checked_id : checked_id
                    }
                }
                var thename = $("input[name='name']").val();
                var actiontime = $("input[name='start_time']").val();
                var endtime = $("input[name='end_time']").val();
                var goods_limit = $("input[name='goods_limit']").val();
                if(thename == "" || actiontime == "" || endtime == "" || goods_limit == "off"){
                    _alert("带*为必填项，请填写后保存");
                    return;
                }
                var z = JSON.stringify(ajson);
                $(".hidden_input").val(z);
                $(".the_form")[0].submit();
            });
            function _alert(e){
                $(".alertmsg").html(e);
                $(".alert").removeClass("none");
            }
            $(".alertclose").on("click",function(){
                $(".alert").addClass("none");
            });
</script>
</body>
</html>
