var currentPage = 0;
var max = false;
/**
 * 设置label 颜色
 * */
function setLabel () {
  var list = $('#list li');
  for (var i = 0; i < list.length; i++) {
    if ((i + 1) % 3 === 0) {
      list.eq(i).find('.label').addClass('label2');
    } else {
      list.eq(i).find('.label').addClass('label1');
    }
  }
  list.eq(1).find('.label').removeClass('label1').addClass('label2');
}

/**
 * 下拉加载更多数据
 * */
function getLoad () {
  $(window).scroll(function() {
    var srollPos = $(window).scrollTop(); //滚动条距顶部距离(页面超出窗口的高度)
    var pages = currentPage;
    if (max === true){
    	return false;
    }

    if ($(window).height() + $(document).scrollTop() >= $(document).height()) {
     $.ajax({
    	url: '/index.php/soma/package/ajax_get_product_list?id=a450089706&tkid=&p=0',
    	type: 'post',
    	data: {'p': pages},
    	dataType:'json',
    	success: function(s){
    		if (s.status === 1) {
    				var str = '';
    				for (var i = 0; i < s.data.length; i++) {
    					var name = s.data[i].name; // 产品名称
    					var discount = '177'; // 折后价
    					var pic = '122'; // 图片
    					var original = '1222'; // 原价
    					var href = 'http:www.baidu.com'; // 链接
    					var label = '测试'; // 标签
    					var appendString = '<li class="pr">' +
	                        '<div class="pa label">' +
	                           '<span class="f24">'+ label +'</span>'+
	                        '</div>' +
	                        '<a href="'+ href +'">'+
	                           '<p class="img"><img src="'+ pic +'"></p>'+
	                           '<p class="title f30">'+ name+'</p>'+
	                           '<div class="price">' +
	                               '<p>'+
	                                   '<span class="f24">¥</span>'+
	                                   '<span class="discount f36">'+discount+'</span>'+
	                                   '<span class="original f24">¥ '+ original +'</span>'+
	                               '</p>'+
	                           '</div>'+
	                         '</a>'+
                      	'</li>';
                      	str = str + appendString;
    				}
    				$(str).appendTo($('#list'));
    				currentPage ++;
			      setLabel();
    		} else if (s.status === 2 && s.msg === '查找数据为空！') {
    			max = true;
    		}
    	}
    });
    }

  });
}

getLoad();
setLabel();